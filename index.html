// –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let gameState = {
    score: 0,
    level: 1,
    clickPower: 1,
    autoClicker: 0,
    clickMultiplier: 1,
    upgrades: {
        clickPower: { baseCost: 10, cost: 10 },
        autoClicker: { baseCost: 50, cost: 50 },
        clickMultiplier: { baseCost: 100, cost: 100 }
    }
};

// –≠–ª–µ–º–µ–Ω—Ç—ã DOM
const elements = {
    score: document.getElementById('score'),
    level: document.getElementById('level'),
    clickPower: document.getElementById('clickPower'),
    cps: document.getElementById('cps'),
    clickBtn: document.getElementById('clickBtn'),
    costElements: {
        clickPower: document.getElementById('clickPowerCost'),
        autoClicker: document.getElementById('autoClickerCost'),
        multiplier: document.getElementById('multiplierCost')
    }
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
function initTelegram() {
    try {
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        console.log('Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
    } catch (error) {
        console.log('Telegram Web App –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
    }
}

// –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∏–∫
function setupClickHandler() {
    elements.clickBtn.addEventListener('click', handleClick);
    console.log('–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
}

function handleClick() {
    const points = gameState.clickPower * gameState.clickMultiplier;
    gameState.score += points;
    
    updateDisplay();
    animateClick();
    
    // –í–∏–±—Ä–∞—Ü–∏—è –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞
    if (window.navigator.vibrate) {
        window.navigator.vibrate(50);
    }
    
    console.log(–ö–ª–∏–∫! +${points} –æ—á–∫–æ–≤, –≤—Å–µ–≥–æ: ${gameState.score});
}

// –ê–Ω–∏–º–∞—Ü–∏—è –∫–ª–∏–∫–∞
function animateClick() {
    elements.clickBtn.style.transform = 'scale(0.95)';
    setTimeout(() => {
        elements.clickBtn.style.transform = 'scale(1)';
    }, 100);
}

// –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
function startAutoClicker() {
    setInterval(() => {
        if (gameState.autoClicker > 0) {
            const autoPoints = gameState.autoClicker * gameState.clickMultiplier;
            gameState.score += autoPoints;
            updateDisplay();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            if (autoPoints > 0) {
                console.log(–ê–≤—Ç–æ–∫–ª–∏–∫! +${autoPoints} –æ—á–∫–æ–≤);
            }
        }
    }, 1000);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
function updateDisplay() {
    elements.score.textContent = Math.floor(gameState.score);
    elements.level.textContent = gameState.level;
    elements.clickPower.textContent = gameState.clickPower * gameState.clickMultiplier;
    elements.cps.textContent = gameState.autoClicker * gameState.clickMultiplier;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã
    elements.costElements.clickPower.textContent = gameState.upgrades.clickPower.cost;
    elements.costElements.autoClicker.textContent = gameState.upgrades.autoClicker.cost;
    elements.costElements.multiplier.textContent = gameState.upgrades.clickMultiplier.cost;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–≤–µ–Ω—å
    checkLevel();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ —É–ª—É—á—à–µ–Ω–∏–π
    updateUpgradeButtons();
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
function checkLevel() {
    const newLevel = Math.floor(gameState.score / 1000) + 1;
    if (newLevel > gameState.level) {
        gameState.level = newLevel;
        showLevelUpMessage();
    }
}

// –°–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ
function showLevelUpMessage() {
    try {
        Telegram.WebApp.showPopup({
            title: 'üéâ –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!',
            message: –¢—ã –¥–æ—Å—Ç–∏–≥ ${gameState.level} —É—Ä–æ–≤–Ω—è!,
            buttons: [{ type: 'ok' }]
        });
    } catch (error) {
        alert(üéâ –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å! –¢—ã –¥–æ—Å—Ç–∏–≥ ${gameState.level} —É—Ä–æ–≤–Ω—è!);
    }
}

// –°–∏—Å—Ç–µ–º–∞ —É–ª—É—á—à–µ–Ω–∏–π
function setupUpgradeHandlers() {
    const upgradeButtons = document.querySelectorAll('.upgrade-btn');
    
    upgradeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const type = this.getAttribute('data-type');
            buyUpgrade(type);
        });
    });
    
    console.log('–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
}
